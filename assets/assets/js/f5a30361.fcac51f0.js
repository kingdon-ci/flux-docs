"use strict";(self.webpackChunkweave_gitops_docs=self.webpackChunkweave_gitops_docs||[]).push([[63265],{72565:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var t=n(87462),a=(n(67294),n(3905));const o={title:"Set variables for Terraform resources",hide_title:!0},i="Use TF-controller to set variables for Terraform resources",s={unversionedId:"terraform/using-terraform-cr/set-variables-for-trraform-resources",id:"version-0.24.0/terraform/using-terraform-cr/set-variables-for-trraform-resources",title:"Set variables for Terraform resources",description:"This is a breaking change of the v1alpha1 API.",source:"@site/versioned_docs/version-0.24.0/terraform/using-terraform-cr/set-variables-for-trraform-resources.mdx",sourceDirName:"terraform/using-terraform-cr",slug:"/terraform/using-terraform-cr/set-variables-for-trraform-resources",permalink:"/docs/0.24.0/terraform/using-terraform-cr/set-variables-for-trraform-resources",draft:!1,editUrl:"https://github.com/weaveworks/weave-gitops/edit/main/website/versioned_docs/version-0.24.0/terraform/using-terraform-cr/set-variables-for-trraform-resources.mdx",tags:[],version:"0.24.0",frontMatter:{title:"Set variables for Terraform resources",hide_title:!0},sidebar:"docs",previous:{title:"Disable drift detection",permalink:"/docs/0.24.0/terraform/using-terraform-cr/drift-detection-disabled"},next:{title:"Configure Custom Backend",permalink:"/docs/0.24.0/terraform/using-terraform-cr/custom-backend"}},l={},c=[{value:"Set variables",id:"set-variables",level:2},{value:"Variables as HCL",id:"variables-as-hcl",level:2}],p={toc:c};function m(e){let{components:r,...n}=e;return(0,a.kt)("wrapper",(0,t.Z)({},p,n,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"use-tf-controller-to-set-variables-for-terraform-resources"},"Use TF-controller to set variables for Terraform resources"),(0,a.kt)("admonition",{title:"Breaking Change",type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"This is a breaking change of the ",(0,a.kt)("inlineCode",{parentName:"p"},"v1alpha1")," API.")),(0,a.kt)("p",null,"Users who are upgrading from TF-controller <= 0.7.0 require updating ",(0,a.kt)("inlineCode",{parentName:"p"},"varsFrom"),",\nfrom a single object:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{2}","{2}":!0},"  varsFrom:\n    kind: ConfigMap\n    name: cluster-config\n")),(0,a.kt)("p",null,"to be an array of object, like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{2}","{2}":!0},"  varsFrom:\n  - kind: ConfigMap\n    name: cluster-config\n")),(0,a.kt)("h2",{id:"set-variables"},"Set variables"),(0,a.kt)("p",null,"TF-controller allows you to pass variables to Terraform using the ",(0,a.kt)("inlineCode",{parentName:"p"},"vars")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"varsFrom")," fields in a ",(0,a.kt)("inlineCode",{parentName:"p"},"Terraform")," object."),(0,a.kt)("p",null,"Inline variables can be set using the ",(0,a.kt)("inlineCode",{parentName:"p"},"vars")," field, which supports HCL string, number, bool, object, and list types.\nThe ",(0,a.kt)("inlineCode",{parentName:"p"},"varsFrom")," field accepts a list of ",(0,a.kt)("inlineCode",{parentName:"p"},"ConfigMaps")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"Secrets")," and allows you to select specific keys using\nthe ",(0,a.kt)("inlineCode",{parentName:"p"},"varsKeys")," property, or you can omit this field to select all keys from the input source."),(0,a.kt)("p",null,"If the same variable key is passed multiple times, the controller will use the latter most instance of the key\npassed to ",(0,a.kt)("inlineCode",{parentName:"p"},"varsFrom"),"."),(0,a.kt)("p",null,"Here is an example of a ",(0,a.kt)("inlineCode",{parentName:"p"},"Terraform")," object that sets inline variables\nusing the ",(0,a.kt)("inlineCode",{parentName:"p"},"vars")," field and retrieves variables from a ",(0,a.kt)("inlineCode",{parentName:"p"},"ConfigMap")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"Secret")," using the ",(0,a.kt)("inlineCode",{parentName:"p"},"varsFrom")," field:"),(0,a.kt)("details",null,(0,a.kt)("summary",null,"Expand to view"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{15-20,22-28}","{15-20,22-28}":!0},"---\napiVersion: infra.contrib.fluxcd.io/v1alpha1\nkind: Terraform\nmetadata:\n  name: helloworld\n  namespace: flux-system\nspec:\n  approvePlan: auto\n  interval: 1m\n  path: ./\n  sourceRef:\n    kind: GitRepository\n    name: helloworld\n    namespace: flux-system\n  vars:\n  - name: region\n    value: us-east-1\n  - name: env\n    value: dev\n  - name: instanceType\n    value: t3-small\n  varsFrom:\n  - kind: ConfigMap\n    name: cluster-config\n    varsKeys:\n    - nodeCount\n    - instanceType\n  - kind: Secret\n    name: cluster-creds\n"))),(0,a.kt)("h2",{id:"variables-as-hcl"},"Variables as HCL"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"vars")," field in a ",(0,a.kt)("inlineCode",{parentName:"p"},"Terraform")," object allows you to set variables for your Terraform configuration.\nThis field supports HCL string, number, bool, object, and list types."),(0,a.kt)("p",null,"In the example provided, the vars field sets the value of the ",(0,a.kt)("inlineCode",{parentName:"p"},"cluster_spec"),' variable to an object\nwith four fields: "region", "env", "node_count", and "public". The "region" and "env" fields are strings,\nthe "node_count" field is a number, and the "public" field is a boolean.'),(0,a.kt)("p",null,"This allows you to set variables in your Terraform configuration in a flexible and dynamic way,\nusing data that can be passed in through the ",(0,a.kt)("inlineCode",{parentName:"p"},"Terraform")," object."),(0,a.kt)("details",null,(0,a.kt)("summary",null,"Expand to view"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-hcl",metastring:"{3-6}","{3-6}":!0},'variable "cluster_spec" {\n  type = object({\n      region     = string\n      env        = string\n      node_count = number\n      public     = bool\n  })\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{17-20}","{17-20}":!0},"---\napiVersion: infra.contrib.fluxcd.io/v1alpha1\nkind: Terraform\nmetadata:\n  name: helloworld\n  namespace: flux-system\nspec:\n  approvePlan: auto\n  interval: 1m\n  path: ./\n  sourceRef:\n    kind: GitRepository\n    name: helloworld\n    namespace: flux-system\n  vars:\n  - name: cluster_spec\n    value:\n      region: us-east-1\n      env: dev\n      node_count: 10\n      public: false\n"))))}m.isMDXComponent=!0},3905:(e,r,n)=>{n.d(r,{Zo:()=>p,kt:()=>d});var t=n(67294);function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function i(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach((function(r){a(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function s(e,r){if(null==e)return{};var n,t,a=function(e,r){if(null==e)return{};var n,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||(a[n]=e[n]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=t.createContext({}),c=function(e){var r=t.useContext(l),n=r;return e&&(n="function"==typeof e?e(r):i(i({},r),e)),n},p=function(e){var r=c(e.components);return t.createElement(l.Provider,{value:r},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},f=t.forwardRef((function(e,r){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=c(n),f=a,d=m["".concat(l,".").concat(f)]||m[f]||u[f]||o;return n?t.createElement(d,i(i({ref:r},p),{},{components:n})):t.createElement(d,i({ref:r},p))}));function d(e,r){var n=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=f;var s={};for(var l in r)hasOwnProperty.call(r,l)&&(s[l]=r[l]);s.originalType=e,s[m]="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return t.createElement.apply(null,i)}return t.createElement.apply(null,n)}f.displayName="MDXCreateElement"}}]);