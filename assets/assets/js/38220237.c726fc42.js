"use strict";(self.webpackChunkweave_gitops_docs=self.webpackChunkweave_gitops_docs||[]).push([[22021],{73926:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var n=a(87462),r=(a(67294),a(3905));const s={title:"Upgrade to Flux GA",hide_title:!0},i="Upgrade to Flux GA",o={unversionedId:"guides/fluxga-upgrade",id:"version-0.32.0/guides/fluxga-upgrade",title:"Upgrade to Flux GA",description:"We are very excited for the release of the Flux v2.0 GA!",source:"@site/versioned_docs/version-0.32.0/guides/fluxga-upgrade.mdx",sourceDirName:"guides",slug:"/guides/fluxga-upgrade",permalink:"/docs/0.32.0/guides/fluxga-upgrade",draft:!1,editUrl:"https://github.com/weaveworks/weave-gitops/edit/main/website/versioned_docs/version-0.32.0/guides/fluxga-upgrade.mdx",tags:[],version:"0.32.0",frontMatter:{title:"Upgrade to Flux GA",hide_title:!0},sidebar:"docs",previous:{title:"Displaying Custom Metadata",permalink:"/docs/0.32.0/guides/displaying-custom-metadata"},next:{title:"Introduction",permalink:"/docs/0.32.0/pipelines/pipelines-intro"}},l={},p=[{value:"Before Starting the Upgrade",id:"before-starting-the-upgrade",level:2},{value:"FAQ",id:"faq",level:2},{value:"Why Upgrade to Flux GA",id:"why-upgrade-to-flux-ga",level:3},{value:"Can I Use Weave GitOps with Flux GA?",id:"can-i-use-weave-gitops-with-flux-ga",level:3},{value:"Can I Use Weave GitOps Enterprise with Flux GA?",id:"can-i-use-weave-gitops-enterprise-with-flux-ga",level:3},{value:"v0.23.0 onwards",id:"v0230-onwards",level:4},{value:"v0.22.0",id:"v0220",level:4},{value:"Can I Use Weave GitOps with Flux v2 0.x (pre-GA versions)?",id:"can-i-use-weave-gitops-with-flux-v2-0x-pre-ga-versions",level:3},{value:"Upgrade",id:"upgrade",level:2},{value:"1. Upgrade to Flux GA on your existing leaf clusters and management clusters",id:"1-upgrade-to-flux-ga-on-your-existing-leaf-clusters-and-management-clusters",level:3},{value:"2. Upgrade to Flux GA in ClusterBootstrapConfigs",id:"2-upgrade-to-flux-ga-in-clusterbootstrapconfigs",level:3},{value:"3. Upgrade to latest WGE",id:"3-upgrade-to-latest-wge",level:3},{value:"4. Upgrade GitOpsTemplates, GitOpsSets, and ClusterBootstrapConfigs",id:"4-upgrade-gitopstemplates-gitopssets-and-clusterbootstrapconfigs",level:3},{value:"<code>GitOpsTemplate</code> and <code>CAPITemplate</code>",id:"gitopstemplate-and-capitemplate",level:4},{value:"<code>GitOpsSets</code>",id:"gitopssets",level:4},{value:"5. Future steps",id:"5-future-steps",level:3},{value:"Contact us",id:"contact-us",level:2}],u={toc:p};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"upgrade-to-flux-ga"},"Upgrade to Flux GA"),(0,r.kt)("p",null,"We are very excited for the release of the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fluxcd/flux2/releases"},"Flux v2.0 GA!")),(0,r.kt)("p",null,"This guide aims to answer some ",(0,r.kt)("a",{parentName:"p",href:"#faq"},"common questions")," before starting the upgrade, and provides step-by-step\ninstructions."),(0,r.kt)("h2",{id:"before-starting-the-upgrade"},"Before Starting the Upgrade"),(0,r.kt)("p",null,"Useful terms used in this guide:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Flux Beta or Flux v0.x")," as the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/fluxcd/flux2/releases/tag/v0.41.2"},"latest Flux Beta Release"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Flux GA")," as the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/fluxcd/flux2/releases/tag/v2.0.0-rc.3"},"latest Flux GA Release Candidate")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Weave GitOps")," as the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/weaveworks/weave-gitops-enterprise/releases/latest"},"latest Weave GitOps Enterprise release"))),(0,r.kt)("h2",{id:"faq"},"FAQ"),(0,r.kt)("p",null,"Here you can find the most common questions around upgrading."),(0,r.kt)("h3",{id:"why-upgrade-to-flux-ga"},"Why Upgrade to Flux GA"),(0,r.kt)("p",null,"Although Flux Beta APIs have been stable and used in production for quite some time, Flux GA is the main supported API version for new features and development. Features like ",(0,r.kt)("a",{parentName:"p",href:"https://fluxcd.io/flux/cheatsheets/sharding/"},"horizontal scaling"),"\nare only available in Flux GA. Also, beta APIs will be removed after six months."),(0,r.kt)("h3",{id:"can-i-use-weave-gitops-with-flux-ga"},"Can I Use Weave GitOps with Flux GA?"),(0,r.kt)("p",null,"Yes. This has been possible since Weave Gitops v0.22.0. Use the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/weaveworks/weave-gitops/releases"},"latest available release")," for the best experience."),(0,r.kt)("h3",{id:"can-i-use-weave-gitops-enterprise-with-flux-ga"},"Can I Use Weave GitOps Enterprise with Flux GA?"),(0,r.kt)("p",null,"Yes. This has been possible since Weave GitOps Enterprise v0.22.0. Use the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitops.weave.works/docs/enterprise/getting-started/releases-enterprise/"},"latest available release")," for the best experience."),(0,r.kt)("p",null,"The following limitations are knowns by version:"),(0,r.kt)("h4",{id:"v0230-onwards"},"v0.23.0 onwards"),(0,r.kt)("p",null,"No limitations"),(0,r.kt)("h4",{id:"v0220"},"v0.22.0"),(0,r.kt)("p",null,"If you are using GitOpsSets, upgrade that component to v0.10.0 for Flux GA compatibility.\nUpdate the Weave GitOps Enterprise HelmRelease values to use the new version."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"gitopssets-controller:\n  controllerManager:\n    manager:\n      image:\n        tag: v0.10.0\n")),(0,r.kt)("h3",{id:"can-i-use-weave-gitops-with-flux-v2-0x-pre-ga-versions"},"Can I Use Weave GitOps with Flux v2 0.x (pre-GA versions)?"),(0,r.kt)("p",null,"As of Weave GitOps v0.29, only Flux v2.0 GA is supported. Please follow the ",(0,r.kt)("a",{parentName:"p",href:"#upgrade"},"Upgrade")," section to help you with the process."),(0,r.kt)("p",null,"Earlier versions of Weave GitOps work with both Flux v2 GA and Flux v2 0.x (the pre-GA ones), but it is encouraged that you upgrade to the latest version for the best experience."),(0,r.kt)("h2",{id:"upgrade"},"Upgrade"),(0,r.kt)("admonition",{title:"Hosted flux?",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"If you are using a hosted Flux version, please check with your provider if they support Flux GA before upgrading following this guide.\nKnown hosted Flux providers:"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"EKS Anywhere"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/azure/azure-arc/kubernetes/extensions-release#flux-gitops"},"Azure AKS Flux-GitOps extension"))),(0,r.kt)("p",{parentName:"admonition"},"As of writing they do not yet support the new version, so please wait before upgrading to Flux GA.")),(0,r.kt)("p",null,"Below, we'll take you through the multiple steps required to migrate to your system to Flux GA. After each step the cluster will be\nin a working state, so you can take your time to complete the migration."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Upgrade to Flux GA on your existing leaf clusters and management clusters"),(0,r.kt)("li",{parentName:"ol"},"Upgrade to Flux GA in ",(0,r.kt)("inlineCode",{parentName:"li"},"ClusterBootstrapConfig"),"s."),(0,r.kt)("li",{parentName:"ol"},"Upgrade to ",(0,r.kt)("a",{parentName:"li",href:"https://docs.gitops.weave.works/docs/enterprise/getting-started/releases-enterprise/"},"latest Weave GitOps"),"."),(0,r.kt)("li",{parentName:"ol"},"Upgrade GitopsTemplates, GitopsSets and ClusterBootstrapConfigs.")),(0,r.kt)("h3",{id:"1-upgrade-to-flux-ga-on-your-existing-leaf-clusters-and-management-clusters"},"1. Upgrade to Flux GA on your existing leaf clusters and management clusters"),(0,r.kt)("p",null,"Follow the upgrade instructions from the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fluxcd/flux2/releases/tag/v2.0.0"},"Flux v2.0.0 release notes"),"."),(0,r.kt)("p",null,"At minimum, you'll need to rerun the ",(0,r.kt)("inlineCode",{parentName:"p"},"flux bootstrap")," command on your leaf clusters and management clusters."),(0,r.kt)("p",null,"You'll also need to bump API versions in your manifests to ",(0,r.kt)("inlineCode",{parentName:"p"},"v1")," as described in the Flux upgrade instructions:"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Bumping the APIs version in manifests can be done gradually. It is advised to not delay this procedure as the beta\nversions will be removed after 6 months.")),(0,r.kt)("p",null,"At this stage all clusters are running Flux GA."),(0,r.kt)("h3",{id:"2-upgrade-to-flux-ga-in-clusterbootstrapconfigs"},"2. Upgrade to Flux GA in ClusterBootstrapConfigs"),(0,r.kt)("p",null,"First, we ensure any new clusters are bootstrapped with Flux GA. Then we'll upgrade the existing clusters."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ClusterBootstrapConfig")," will most often contain an invocation of ",(0,r.kt)("inlineCode",{parentName:"p"},"flux bootstrap"),". Make sure the image is using ",(0,r.kt)("inlineCode",{parentName:"p"},"v2"),"."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Expand to see an example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-patch"},'diff --git a/tools/dev-resources/user-guide/cluster-bootstrap-config.yaml b/tools/dev-resources/user-guide/cluster-bootstrap-config.yaml\nindex bd41ec036..1b21df860 100644\n--- a/tools/dev-resources/user-guide/cluster-bootstrap-config.yaml\n+++ b/tools/dev-resources/user-guide/cluster-bootstrap-config.yaml\n@@ -1,34 +1,34 @@\n apiVersion: capi.weave.works/v1alpha1\n kind: ClusterBootstrapConfig\n metadata:\n   name: capi-gitops\n   namespace: default\n spec:\n   clusterSelector:\n     matchLabels:\n       weave.works/capi: bootstrap\n   jobTemplate:\n     generateName: "run-gitops-{{ .ObjectMeta.Name }}"\n     spec:\n       containers:\n-        - image: ghcr.io/fluxcd/flux-cli:v0.34.0\n+        - image: ghcr.io/fluxcd/flux-cli:v2.0.0\n           name: flux-bootstrap\n           ...\n'))),(0,r.kt)("p",null,"At this stage, your new bootstrapped clusters will run Flux GA."),(0,r.kt)("h3",{id:"3-upgrade-to-latest-wge"},"3. Upgrade to latest WGE"),(0,r.kt)("p",null,"Use your regular WGE upgrade procedure to bring it to the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitops.weave.works/docs/enterprise/getting-started/releases-enterprise/"},"latest version")),(0,r.kt)("p",null,"At this stage you have Weave GitOps running Flux GA."),(0,r.kt)("h3",{id:"4-upgrade-gitopstemplates-gitopssets-and-clusterbootstrapconfigs"},"4. Upgrade GitOpsTemplates, GitOpsSets, and ClusterBootstrapConfigs"),(0,r.kt)("p",null,"Bumping the APIs version in manifests can be done gradually. We advise against delaying this procedure as the Beta versions will be removed after six months."),(0,r.kt)("h4",{id:"gitopstemplate-and-capitemplate"},(0,r.kt)("inlineCode",{parentName:"h4"},"GitOpsTemplate")," and ",(0,r.kt)("inlineCode",{parentName:"h4"},"CAPITemplate")),(0,r.kt)("p",null,"Update ",(0,r.kt)("inlineCode",{parentName:"p"},"GitRepository")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Kustomization")," CRs in the ",(0,r.kt)("inlineCode",{parentName:"p"},"spec.resourcetemplates")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"v1")," as described in the flux upgrade instructions."),(0,r.kt)("h4",{id:"gitopssets"},(0,r.kt)("inlineCode",{parentName:"h4"},"GitOpsSets")),(0,r.kt)("p",null,"Update ",(0,r.kt)("inlineCode",{parentName:"p"},"GitRepository")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Kustomization")," CRs in the ",(0,r.kt)("inlineCode",{parentName:"p"},"spec.template")," of your ",(0,r.kt)("inlineCode",{parentName:"p"},"GitOpsSet")," resources to ",(0,r.kt)("inlineCode",{parentName:"p"},"v1")," as described in the Flux upgrade instructions."),(0,r.kt)("h3",{id:"5-future-steps"},"5. Future steps"),(0,r.kt)("p",null,"If you haven't done it yet, plan to update your  ",(0,r.kt)("inlineCode",{parentName:"p"},"Kustomization")," , ",(0,r.kt)("inlineCode",{parentName:"p"},"GitRepository")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Receiver")," resources to ",(0,r.kt)("inlineCode",{parentName:"p"},"v1"),", you can also upgrade to the future release of Flux that will drop support for ",(0,r.kt)("inlineCode",{parentName:"p"},"< v1")," APIs."),(0,r.kt)("h2",{id:"contact-us"},"Contact us"),(0,r.kt)("p",null,"If you find any issues, please let us know via ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitops.weave.works/help-and-support/"},"support"),"."))}d.isMDXComponent=!0},3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},d="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=p(a),c=r,m=d["".concat(l,".").concat(c)]||d[c]||g[c]||s;return a?n.createElement(m,i(i({ref:t},u),{},{components:a})):n.createElement(m,i({ref:t},u))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,i=new Array(s);i[0]=c;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[d]="string"==typeof e?e:r,i[1]=o;for(var p=2;p<s;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"}}]);