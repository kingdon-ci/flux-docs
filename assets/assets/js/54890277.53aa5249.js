"use strict";(self.webpackChunkweave_gitops_docs=self.webpackChunkweave_gitops_docs||[]).push([[59021],{88022:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(67294),o=r(88746);r(52426);const a={fontSize:16,marginLeft:4,fontVariant:"all-small-caps"};function i(e){let{tiers:t}=e;return n.createElement(o.Z,{title:`This feature is a available on ${t}.`,style:a},t)}},50918:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var n=r(87462),o=(r(67294),r(3905)),a=r(88022);const i={title:"Cluster Management Troubleshooting"},l='Cluster Management Troubleshooting <TierLabel tiers="Enterprise" />',s={unversionedId:"cluster-management/cluster-management-troubleshooting",id:"version-0.30.0/cluster-management/cluster-management-troubleshooting",title:"Cluster Management Troubleshooting",description:"We'll use this page to help you move past common troublesome situations.",source:"@site/versioned_docs/version-0.30.0/cluster-management/cluster-management-troubleshooting.mdx",sourceDirName:"cluster-management",slug:"/cluster-management/cluster-management-troubleshooting",permalink:"/docs/0.30.0/cluster-management/cluster-management-troubleshooting",draft:!1,editUrl:"https://github.com/weaveworks/weave-gitops/edit/main/website/versioned_docs/version-0.30.0/cluster-management/cluster-management-troubleshooting.mdx",tags:[],version:"0.30.0",frontMatter:{title:"Cluster Management Troubleshooting"},sidebar:"docs",previous:{title:"Profiles",permalink:"/docs/0.30.0/cluster-management/profiles"},next:{title:"How to Inject Credentials Into Your Template",permalink:"/docs/0.30.0/cluster-management/advanced-cluster-management-topics/howto-inject-credentials-into-template"}},p={},c=[{value:"Git Repositories and Resources",id:"git-repositories-and-resources",level:2},{value:"Overriding the Calculated Git Repository HTTPS URL",id:"overriding-the-calculated-git-repository-https-url",level:3}],u={toc:c};function m(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"cluster-management-troubleshooting-"},"Cluster Management Troubleshooting ",(0,o.kt)(a.Z,{tiers:"Enterprise",mdxType:"TierLabel"})),(0,o.kt)("p",null,"We'll use this page to help you move past common troublesome situations. "),(0,o.kt)("h2",{id:"git-repositories-and-resources"},"Git Repositories and Resources"),(0,o.kt)("p",null,"To authenticate using Git during the pull request creation, you will need to select the Git repository where you'll create the pull request.  "),(0,o.kt)("p",null,"Depending on the action performed on the resource (creation/deletion/editing), the default Git repository selected in the UI is determined in the following order:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"the repository used to initially create the resource found in the ",(0,o.kt)("inlineCode",{parentName:"p"},"templates.weave.works/create-request")," annotation (in the case of editing or deleting of resources)"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'metadata:\n  annotations:\n    templates.weave.works/create-request: "{...\\"parameter_values\\":{...\\"url\\":\\"https://github.com/weave-example-org/weave-demo\\"}"\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"the first repository found with a ",(0,o.kt)("inlineCode",{parentName:"p"},"weave.works/repo-role: default")," annotation"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"metadata:\n  annotations:\n    weave.works/repo-role: default\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"the flux-system repository "),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"metadata:\n  name: flux-system\n  namespace: flux-system\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"the first repository in the list of Git repositories that the user has access to."))),(0,o.kt)("p",null,"In the case of deletion and editing, if the resource repository is found amongst the Git repositories that the user has access to, it will be preselected and the selection will be disabled. If it is not found, you can choose a new repository."),(0,o.kt)("p",null,"In the case of tenants, we recommend adding the ",(0,o.kt)("inlineCode",{parentName:"p"},"weave.works/repo-role: default")," to an appropriate Git repository."),(0,o.kt)("h3",{id:"overriding-the-calculated-git-repository-https-url"},"Overriding the Calculated Git Repository HTTPS URL"),(0,o.kt)("p",null,"The system will try and automatically calculate the correct HTTPS API endpoint to create a pull request against. For example, if the Git repository URL is ",(0,o.kt)("inlineCode",{parentName:"p"},"ssh://git@github.com/org/repo.git"),", the system will try and convert it to ",(0,o.kt)("inlineCode",{parentName:"p"},"https://github.com/org/repo.git"),"."),(0,o.kt)("p",null,"However, it is not always possible to accurately derive this URL. An override can be specified to set the correct URL instead. For example, the SSH URL may be ",(0,o.kt)("inlineCode",{parentName:"p"},"ssh://git@interal-ssh-server:2222/org/repo.git")," and the correct HTTPS URL may be ",(0,o.kt)("inlineCode",{parentName:"p"},"https://gitlab.example.com/org/repo.git"),". "),(0,o.kt)("p",null,"In this case, we set the override via the ",(0,o.kt)("inlineCode",{parentName:"p"},"weave.works/repo-https-url")," annotation on the ",(0,o.kt)("inlineCode",{parentName:"p"},"GitRepository")," object:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: source.toolkit.fluxcd.io/v1beta1\nkind: GitRepository\nmetadata:\n  name: repo\n  namespace: flux-system\n  annotations:\n    // highlight-start\n    weave.works/repo-https-url: https://gitlab.example.com/org/repo.git\n    // highlight-end\nspec:\n  interval: 1m\n  url: ssh://git@interal-ssh-server:2222/org/repo.git\n")),(0,o.kt)("p",null,"The pull request will then be created against the correct HTTPS API."),(0,o.kt)("p",null,"The above also applies to application creation."))}m.isMDXComponent=!0},3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>g});var n=r(67294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=n.createContext({}),p=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(r),d=o,g=u["".concat(s,".").concat(d)]||u[d]||m[d]||a;return r?n.createElement(g,i(i({ref:t},c),{},{components:r})):n.createElement(g,i({ref:t},c))}));function g(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:o,i[1]=l;for(var p=2;p<a;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"}}]);