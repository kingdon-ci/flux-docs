"use strict";(self.webpackChunkweave_gitops_docs=self.webpackChunkweave_gitops_docs||[]).push([[17507],{55094:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var n=a(87462),i=(a(67294),a(3905));const s={title:"Upgrade to Flux GA",hide_title:!0},r="Upgrade to Flux GA",o={unversionedId:"guides/fluxga-upgrade",id:"version-0.28.0/guides/fluxga-upgrade",title:"Upgrade to Flux GA",description:"We are very excited for the release of the Flux GA!",source:"@site/versioned_docs/version-0.28.0/guides/fluxga-upgrade.mdx",sourceDirName:"guides",slug:"/guides/fluxga-upgrade",permalink:"/docs/0.28.0/guides/fluxga-upgrade",draft:!1,editUrl:"https://github.com/weaveworks/weave-gitops/edit/main/website/versioned_docs/version-0.28.0/guides/fluxga-upgrade.mdx",tags:[],version:"0.28.0",frontMatter:{title:"Upgrade to Flux GA",hide_title:!0},sidebar:"docs",previous:{title:"Displaying Custom Metadata",permalink:"/docs/0.28.0/guides/displaying-custom-metadata"},next:{title:"Introduction",permalink:"/docs/0.28.0/pipelines/intro"}},l={},p=[{value:"Before Starting",id:"before-starting",level:2},{value:"Important events during this period",id:"important-events-during-this-period",level:2},{value:"FAQ",id:"faq",level:2},{value:"Why upgrade to Flux GA",id:"why-upgrade-to-flux-ga",level:3},{value:"Can I use Weave Gitops with Flux GA Release Candidates?",id:"can-i-use-weave-gitops-with-flux-ga-release-candidates",level:3},{value:"Can I use Weave Gitops Enterprise with Flux GA Release Candidates?",id:"can-i-use-weave-gitops-enterprise-with-flux-ga-release-candidates",level:3},{value:"v0.23.0 onwards",id:"v0230-onwards",level:4},{value:"v0.22.0",id:"v0220",level:4},{value:"I am using Weave Gitops v0.22 (or later) with Flux Beta, what is the impact?",id:"i-am-using-weave-gitops-v022-or-later-with-flux-beta-what-is-the-impact",level:3},{value:"I am using Weave Gitops EE v0.22 (or later) with Flux Beta, what is the impact?",id:"i-am-using-weave-gitops-ee-v022-or-later-with-flux-beta-what-is-the-impact",level:3},{value:"What is the support strategy and timelines?",id:"what-is-the-support-strategy-and-timelines",level:3},{value:"When support for Flux Beta will be dropped?",id:"when-support-for-flux-beta-will-be-dropped",level:3},{value:"Will be able to use Flux Beta once Flux GA is released?",id:"will-be-able-to-use-flux-beta-once-flux-ga-is-released",level:3},{value:"Upgrade",id:"upgrade",level:2},{value:"1. Upgrade to latest WGE",id:"1-upgrade-to-latest-wge",level:3},{value:"2. Upgrade to Flux GA in ClusterBootstrapConfigs",id:"2-upgrade-to-flux-ga-in-clusterbootstrapconfigs",level:3},{value:"3. Upgrade to Flux GA on your existing leaf clusters and management clusters",id:"3-upgrade-to-flux-ga-on-your-existing-leaf-clusters-and-management-clusters",level:3},{value:"4. Upgrade GitopsTemplates, GitopsSets and ClusterBootstrapConfigs",id:"4-upgrade-gitopstemplates-gitopssets-and-clusterbootstrapconfigs",level:3},{value:"<code>GitopsTemplate</code> and <code>CAPITemplate</code>",id:"gitopstemplate-and-capitemplate",level:4},{value:"<code>GitopsSets</code>",id:"gitopssets",level:4},{value:"5. Future steps",id:"5-future-steps",level:3},{value:"Contact us",id:"contact-us",level:2}],u={toc:p};function d(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"upgrade-to-flux-ga"},"Upgrade to Flux GA"),(0,i.kt)("p",null,"We are very excited for the release of the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/fluxcd/flux2/releases"},"Flux GA!")),(0,i.kt)("p",null,"This guide aims to answer some ",(0,i.kt)("a",{parentName:"p",href:"#faq"},"common questions")," before starting the upgrade, as well as providing step-by-step\ninstructions for the ",(0,i.kt)("a",{parentName:"p",href:"#upgrade"},"upgrade"),"."),(0,i.kt)("h2",{id:"before-starting"},"Before Starting"),(0,i.kt)("p",null,"Here there are some useful terms that are used in this guide:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Flux Beta or Flux v0.x")," as the ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/fluxcd/flux2/releases/tag/v0.41.2"},"latest Flux Beta Release"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Flux GA")," as the ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/fluxcd/flux2/releases/tag/v2.0.0-rc.3"},"latest Flux GA Release Candidate")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Weave Gitops")," as the ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/weaveworks/weave-gitops-enterprise/releases/tag/v0.23.0"},"latest Weave Gitops Enterprise release"))),(0,i.kt)("h2",{id:"important-events-during-this-period"},"Important events during this period"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Dates for these events are not finalized and will depend on when the releases are made")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The release of a version of Weave Gitops OSS/EE that will require Flux GA be installed (in the weeks after Flux GA is released)."),(0,i.kt)("li",{parentName:"ul"},"The release of a version of Flux GA that will drop support for ",(0,i.kt)("inlineCode",{parentName:"li"},"< v1")," Custom Resources (~6-12 months after Flux GA is released).")),(0,i.kt)("p",null,"You can take steps today to address both these events."),(0,i.kt)("h2",{id:"faq"},"FAQ"),(0,i.kt)("p",null,"Here you could find the most common questions around upgrading."),(0,i.kt)("h3",{id:"why-upgrade-to-flux-ga"},"Why upgrade to Flux GA"),(0,i.kt)("p",null,"Flux Beta APIs have been stable and used in production for quite some time now. However, with Flux GA there is big reason to move to v1:\nit is the main supported API version for new features and developments. Features like ",(0,i.kt)("a",{parentName:"p",href:"https://fluxcd.io/flux/cheatsheets/sharding/"},"horizontal scaling"),"\nare only available in Flux GA. Also, have into consideration that beta APIs will be removed after 6 months."),(0,i.kt)("p",null,"For more information about the Flux GA roadmap see ",(0,i.kt)("a",{parentName:"p",href:"https://fluxcd.io/roadmap/#the-road-to-flux-v2-ga"},"here")),(0,i.kt)("h3",{id:"can-i-use-weave-gitops-with-flux-ga-release-candidates"},"Can I use Weave Gitops with Flux GA Release Candidates?"),(0,i.kt)("p",null,"Yes, since Weave Gitops v0.22.0, you could use it with Flux GA Release Candidates. It is recommended\nyou use the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/weaveworks/weave-gitops/releases"},"latest available release")," for the best experience."),(0,i.kt)("h3",{id:"can-i-use-weave-gitops-enterprise-with-flux-ga-release-candidates"},"Can I use Weave Gitops Enterprise with Flux GA Release Candidates?"),(0,i.kt)("p",null,"Yes, since Weave Gitops Enterprise v0.22.0, you could use it with Flux GA Release Candidates. It is recommended\nyou use the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.gitops.weave.works/docs/enterprise/getting-started/releases-enterprise/"},"latest available release")," for the best experience."),(0,i.kt)("p",null,"The following limitations are knowns by version:"),(0,i.kt)("h4",{id:"v0230-onwards"},"v0.23.0 onwards"),(0,i.kt)("p",null,"No limitations"),(0,i.kt)("h4",{id:"v0220"},"v0.22.0"),(0,i.kt)("p",null,"If you are using gitopssets we can upgrade that component to gitopssets v0.10.0 for Flux GA compatibility.\nUpdate the Weave Gitops Enterprise HelmRelease values to use the new version."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"gitopssets-controller:\n  controllerManager:\n    manager:\n      image:\n        tag: v0.10.0\n")),(0,i.kt)("h3",{id:"i-am-using-weave-gitops-v022-or-later-with-flux-beta-what-is-the-impact"},"I am using Weave Gitops v0.22 (or later) with Flux Beta, what is the impact?"),(0,i.kt)("p",null,"Latest Weave Gitops is compatible with Flux Beta so no impact is expected."),(0,i.kt)("h3",{id:"i-am-using-weave-gitops-ee-v022-or-later-with-flux-beta-what-is-the-impact"},"I am using Weave Gitops EE v0.22 (or later) with Flux Beta, what is the impact?"),(0,i.kt)("p",null,"Latest Weave Gitops Enterprise is compatible with Flux Beta so no impact is expected."),(0,i.kt)("h3",{id:"what-is-the-support-strategy-and-timelines"},"What is the support strategy and timelines?"),(0,i.kt)("p",null,"Weave Gitops currently supports both Flux Beta and Flux GA v2.0.0 release candidates. It means that features,\nbugs and security patches are compatible with both API versions."),(0,i.kt)("p",null,"We expect this to change once Flux GA v2.0.0 is released. At that moment only Flux GA will be fully supported. Flux Beta\nsupport will be deprecated, only releasing patches for CVEs impacting Weave Gitops for Flux Beta."),(0,i.kt)("p",null,"Looking to timelines, we expect Flux Beta deprecation right after Flux GA is released."),(0,i.kt)("h3",{id:"when-support-for-flux-beta-will-be-dropped"},"When support for Flux Beta will be dropped?"),(0,i.kt)("p",null,"Once Flux GA is released. A concrete date will be given after that event that we expect to be in the range of weeks\nafter the release."),(0,i.kt)("h3",{id:"will-be-able-to-use-flux-beta-once-flux-ga-is-released"},"Will be able to use Flux Beta once Flux GA is released?"),(0,i.kt)("p",null,"It is encouraged you to plan upgrading to Flux GA using its release candidates train. However, if for reasons\nyou are not able to, you will be able to use Weave Gitops with Flux Beta, but we expect you could find increasing limitations\nas new features would design with Flux GA APIs in mind."),(0,i.kt)("h2",{id:"upgrade"},"Upgrade"),(0,i.kt)("admonition",{title:"Note",type:"info"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("em",{parentName:"p"},"Flux GA release candidates have the same Kubernetes compatibility as Flux 0.41.2"))),(0,i.kt)("admonition",{title:"Hosted flux?",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"If you are using a hosted Flux version, please check with your provider if they support Flux GA before upgrading following this guide.\nKnown hosted flux providers:"),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"EKS Anywhere"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/azure/azure-arc/kubernetes/extensions-release#flux-gitops"},"Azure AKS Flux-Gitops extension"))),(0,i.kt)("p",{parentName:"admonition"},"As of writing they do not yet support the new version so please wait before upgrading to Flux GA.")),(0,i.kt)("p",null,"Below, we'll take you through the multiple steps required to migrate to your system to Flux GA. After each step the cluster will be\nin a working state, so you can take your time to complete the migration."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Upgrade to ",(0,i.kt)("a",{parentName:"li",href:"https://docs.gitops.weave.works/docs/releases/"},"latest Weave Gitops")),(0,i.kt)("li",{parentName:"ol"},"Upgrade to Flux GA in ",(0,i.kt)("inlineCode",{parentName:"li"},"ClusterBootstrapConfig"),"s"),(0,i.kt)("li",{parentName:"ol"},"Upgrade to Flux GA on your leaf clusters and management clusters"),(0,i.kt)("li",{parentName:"ol"},"Upgrade GitopsTemplates, GitopsSets and ClusterBootstrapConfigs")),(0,i.kt)("h3",{id:"1-upgrade-to-latest-wge"},"1. Upgrade to latest WGE"),(0,i.kt)("p",null,"Use your regular WGE upgrade procedure to bring it to the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.gitops.weave.works/docs/releases/"},"latest")),(0,i.kt)("admonition",{title:"upgrading to Flux GA with WGE v0.22.0?",type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"Ensure that you address ",(0,i.kt)("a",{parentName:"p",href:"#v0220"},"this"))),(0,i.kt)("p",null,"At this stage you have Weave Gitops running Flux Beta."),(0,i.kt)("h3",{id:"2-upgrade-to-flux-ga-in-clusterbootstrapconfigs"},"2. Upgrade to Flux GA in ClusterBootstrapConfigs"),(0,i.kt)("p",null,"First we ensure any new clusters are bootstrapped with Flux GA, then we'll upgrade the existing clusters."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"ClusterBootstrapConfig")," will most often contain an invocation of ",(0,i.kt)("inlineCode",{parentName:"p"},"flux bootstrap"),", make sure the image is using ",(0,i.kt)("inlineCode",{parentName:"p"},"v2"),"."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Expand to see an example"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-patch"},'diff --git a/tools/dev-resources/user-guide/cluster-bootstrap-config.yaml b/tools/dev-resources/user-guide/cluster-bootstrap-config.yaml\nindex bd41ec036..1b21df860 100644\n--- a/tools/dev-resources/user-guide/cluster-bootstrap-config.yaml\n+++ b/tools/dev-resources/user-guide/cluster-bootstrap-config.yaml\n@@ -1,34 +1,34 @@\n apiVersion: capi.weave.works/v1alpha1\n kind: ClusterBootstrapConfig\n metadata:\n   name: capi-gitops\n   namespace: default\n spec:\n   clusterSelector:\n     matchLabels:\n       weave.works/capi: bootstrap\n   jobTemplate:\n     generateName: "run-gitops-{{ .ObjectMeta.Name }}"\n     spec:\n       containers:\n-        - image: ghcr.io/fluxcd/flux-cli:v0.34.0\n+        - image: ghcr.io/fluxcd/flux-cli:v2\n           name: flux-bootstrap\n           ...\n'))),"At this stage, your new bootstrapped clusters will run Flux GA.",(0,i.kt)("h3",{id:"3-upgrade-to-flux-ga-on-your-existing-leaf-clusters-and-management-clusters"},"3. Upgrade to Flux GA on your existing leaf clusters and management clusters"),(0,i.kt)("p",null,"Follow the upgrade instructions from the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/fluxcd/flux2/releases/tag/v2.0.0-rc.1"},"Flux v2.0.0-rc.1 release notes"),"."),(0,i.kt)("p",null,"At minimum, you'll need to rerun the ",(0,i.kt)("inlineCode",{parentName:"p"},"flux bootstrap")," command on your leaf clusters and management clusters."),(0,i.kt)("p",null,"You'll also need to bump APIs version in your manifests to ",(0,i.kt)("inlineCode",{parentName:"p"},"v1")," as described in the flux upgrade instructions:"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Bumping the APIs version in manifests can be done gradually. It is advised to not delay this procedure as the beta\nversions will be removed after 6 months.")),(0,i.kt)("p",null,"At this stage all clusters are running Flux GA."),(0,i.kt)("h3",{id:"4-upgrade-gitopstemplates-gitopssets-and-clusterbootstrapconfigs"},"4. Upgrade GitopsTemplates, GitopsSets and ClusterBootstrapConfigs"),(0,i.kt)("p",null,"Bumping the APIs version in manifests can be done gradually. It is advised to not delay this procedure as the beta versions will be removed after 6 months."),(0,i.kt)("h4",{id:"gitopstemplate-and-capitemplate"},(0,i.kt)("inlineCode",{parentName:"h4"},"GitopsTemplate")," and ",(0,i.kt)("inlineCode",{parentName:"h4"},"CAPITemplate")),(0,i.kt)("p",null,"Update ",(0,i.kt)("inlineCode",{parentName:"p"},"GitRepository")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Kustomization")," CRs in the ",(0,i.kt)("inlineCode",{parentName:"p"},"spec.resourcetemplates")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"v1")," as described in the flux upgrade instructions."),(0,i.kt)("h4",{id:"gitopssets"},(0,i.kt)("inlineCode",{parentName:"h4"},"GitopsSets")),(0,i.kt)("p",null,"Update ",(0,i.kt)("inlineCode",{parentName:"p"},"GitRepository")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Kustomization")," CRs in the ",(0,i.kt)("inlineCode",{parentName:"p"},"spec.template")," of your ",(0,i.kt)("inlineCode",{parentName:"p"},"GitopsSet")," resources to ",(0,i.kt)("inlineCode",{parentName:"p"},"v1")," as described in the flux upgrade instructions."),(0,i.kt)("h3",{id:"5-future-steps"},"5. Future steps"),(0,i.kt)("p",null,"At this stage all clusters are running Flux GA. This will allow you to seamlessly upgrade to the upcoming release of Weave Gitops that will drop support for Flux Beta."),(0,i.kt)("p",null,"If you have updated your ",(0,i.kt)("inlineCode",{parentName:"p"},"Kustomization")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"GitRepository")," resources to ",(0,i.kt)("inlineCode",{parentName:"p"},"v1")," you will also be able to upgrade to the future release of Flux that will drop support for ",(0,i.kt)("inlineCode",{parentName:"p"},"< v1")," apis."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Weave Gitops Enterprise 0.23.0 generates v1beta2 ",(0,i.kt)("inlineCode",{parentName:"p"},"Kustomization")," Custom Resources when using the ",(0,i.kt)("em",{parentName:"p"},"Add app")," and ",(0,i.kt)("em",{parentName:"p"},"Cluster Template")," features."),(0,i.kt)("p",{parentName:"admonition"},"This is to support installations still using Flux Beta."),(0,i.kt)("p",{parentName:"admonition"},"After upgrading to the release of Weave Gitops that drops support for Flux Beta, Weave Gitops Enterprise will create ",(0,i.kt)("inlineCode",{parentName:"p"},"v1")," Resources.\nHowever, you will have to manually update any ",(0,i.kt)("inlineCode",{parentName:"p"},"Kustomization")," resources that have been created to ",(0,i.kt)("inlineCode",{parentName:"p"},"v1"),".")),(0,i.kt)("h2",{id:"contact-us"},"Contact us"),(0,i.kt)("p",null,"In case you find any issue, please let us know via ",(0,i.kt)("a",{parentName:"p",href:"https://docs.gitops.weave.works/help-and-support/"},"support"),"."))}d.isMDXComponent=!0},3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>g});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,s=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=p(a),c=i,g=d["".concat(l,".").concat(c)]||d[c]||m[c]||s;return a?n.createElement(g,r(r({ref:t},u),{},{components:a})):n.createElement(g,r({ref:t},u))}));function g(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var s=a.length,r=new Array(s);r[0]=c;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[d]="string"==typeof e?e:i,r[1]=o;for(var p=2;p<s;p++)r[p]=a[p];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"}}]);